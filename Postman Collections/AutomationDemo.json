{
  "info": {
    "name": "AutomationDemo",
    "_postman_id": "9c7b309d-821f-622f-a3cd-da5a2c2f0e49",
    "description": "",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "_postman_id": "3d003648-da88-1b54-8be7-cb0174a1f3dc",
      "name": "Login API",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "",
              "tests[\"Body contains token\"] = responseBody.has(\"token\");",
              "",
              "var jsonData = JSON.parse(responseBody);",
              "",
              "postman.setEnvironmentVariable(\"minerva_token\", jsonData.token);",
              "",
              "",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"{{minerva_user}}\",\n    \"password\": \"{{minerva_user_password}}\"\n}"
        },
        "url": "{{minerva_base_url}}/minerva/api/login",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "d25646c9-d97b-39ea-6858-17029fb4d61e",
      "name": "Get User Details",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "",
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "",
              "var responseJson = JSON.parse(responseBody);",
              "",
              "",
              "tests[\"authorities length > 0\"] = responseJson.authorities.length > 0;",
              "",
              "tests[\"userGroups length > 0\"] = responseJson.userGroups.length > 0;",
              "",
              "tests[\"menuItems length > 0\"] = responseJson.menuItems.length > 0;",
              "",
              "",
              "",
              "",
              "",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "\n\n\n\n"
        },
        "url": "{{minerva_base_url}}/minerva/moUser/getUserDetails",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "e23f4168-6916-da76-cdbd-dbaabaf715e1",
      "name": "Config List",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": "{{minerva_base_url}}/minerva/user/renderConfigList",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "fe8cd823-c9dd-4b9a-9d47-36dd35419f53",
      "name": "Create Patient",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "f3ab3506-8f19-47b8-bdbd-0f66a7f93116",
            "type": "text/javascript",
            "exec": [
              "tests[\"Patient Created Successfully\"] = responseCode.code === 200;",
              "var responseJson = JSON.parse(responseBody);",
              "if(responseJson.patient){",
              "postman.setGlobalVariable(\"patient_id\", responseJson.patient.id);",
              "}",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"patientId\":\"\",\"firstName\":\"Pratyush\",\"middleName\":\"\",\"lastName\":\"\",\"dob\":\"1992-04-08T00:00:00.000Z\",\"gender\":\"M\",\"emailList\":[{\"countryCode\":null,\"primary\":\"true\",\"system\":\"email\",\"useCode\":\"work\",\"value\":\"\"}],\"phoneList\":[{\"countryCode\":\"+91\",\"primary\":\"true\",\"system\":\"phone\",\"useCode\":\"Home Phone\",\"value\":\"9810052808\"}]}"
        },
        "url": "{{minerva_base_url}}/minerva/MoPatient/savePatient",
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "46f10078-0a44-bfd7-2c70-9e0c3c8bfb80",
      "name": "Create User",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"User Created Successfully\"] = responseCode.code === 200;",
              "var responseJson = JSON.parse(responseBody);",
              "tests['Username unique'] = (responseJson.msg !== \"USERNAME_NOT_UNIQUE\");",
              "if(responseJson.user){",
              "postman.setGlobalVariable(\"user_id\", responseJson.user.id);",
              "postman.setGlobalVariable(\"minerva_user2\", responseJson.user.username);",
              "}",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"userGroups\":[5],\"username\":\"test\",\"email\":\"pbansal@mphrx.com\",\"password\":\"test1\",\"firstName\":\"Pratyush \",\"lastName\":\"\",\"phoneNo\":\"9810052808\",\"countryCode\":\"+91\",\"gender\":\"Male\",\"dob\":\"1992-04-08T00:00:00.000Z\",\"activeResource\":{\"status\":\"ACTIVE\"},\"enabled\":true,\"userType\":\"PATIENT\",\"adminCreatedPasswordNeverChanged\":true,\"signUpSource\":\"MINERVA\",\"patientId\":{{patient_id}}}"
        },
        "url": "{{minerva_base_url}}/minerva/moUser/save",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "96034237-f60d-0e5a-e40d-9bd705aa503f",
      "name": "Search User",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "var responseJson = JSON.parse(responseBody);",
              "tests['user found'] = (responseJson && responseJson.totalCount > 0);",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"searchString\":\"pratyush\",\"_skip\":0,\"random\":\"471.7524840478724\",\"includeAnonymous\":true}"
        },
        "url": "{{minerva_base_url}}/minerva/moUser/search",
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "6a8c6629-4def-8ba6-407b-e596a7d8f9bd",
      "name": "Update User",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"User updated\"] = responseCode.code === 200",
              "",
              "",
              "",
              "",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"userGroups\":[5],\"username\":\"test\",\"email\":\"pbansal@mphrx.com\",\"settings\":{\"pushNotificationForMessage\":true,\"pushNotificationForMedicationReminder\":true,\"pushNotificationForDocDigitization\":true,\"pushNotificationForDocRejection\":true},\"enabled\":true,\"firstName\":\"ptest\",\"lastName\":\"mphrx\",\"phoneNo\":\"9810052808\",\"countryCode\":\"+91\",\"gender\":\"Male\",\"userType\":\"PATIENT\",\"dob\":\"1992-04-08T00:00:00.000Z\",\"id\":{{user_id}},\"activeResource\":{\"status\":\"ACTIVE\"},\"patientId\":{{patient_id}}}"
        },
        "url": "{{minerva_base_url}}/minerva/moUser/update",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "3340574a-6b72-de5d-2a51-3f833131c451",
      "name": "Search Updated User",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "var responseJson = JSON.parse(responseBody);",
              "tests['user found'] = (responseJson && responseJson.totalCount > 0);",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          },
          {
            "key": "api-info",
            "value": "{{api-info}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"searchString\":\"ptest\",\"_skip\":0,\"random\":\"471.7524840478724\",\"includeAnonymous\":true}"
        },
        "url": "{{minerva_base_url}}/minerva/moUser/search",
        "description": ""
      },
      "response": []
    },
    {
      "_postman_id": "9a2eeb0b-db39-c6d9-26c9-8149a15a5d21",
      "name": "Login Updated User",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;",
              "",
              "tests[\"Body contains token\"] = responseBody.has(\"token\");",
              "",
              "var jsonData = JSON.parse(responseBody);",
              "if(jsonData){",
              "    postman.setEnvironmentVariable(\"minerva_token\", jsonData.token);",
              "    tests[\"Logged in using new user\"] = (jsonData.id == postman.getGlobalVariable(\"user_id\"));",
              "}",
              "",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"{{minerva_user2}}\",\n    \"password\": \"test1\"\n}"
        },
        "url": "{{minerva_base_url}}/minerva/api/login",
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "0652cfa6-869d-dbca-6bb6-430f7c9ae882",
      "name": "Logout Updated User",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "e2da937a-3c42-4ee9-95f6-368aaa73f34c",
            "type": "text/javascript",
            "exec": [
              "tests[\"User logged out\"] = responseCode.code === 200;",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-auth-token",
            "value": "{{minerva_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{}"
        },
        "url": "{{minerva_base_url}}/minerva/api/logout",
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "acbb2445-6d2f-4c13-9d0b-30c75c1a24cc",
      "name": "Delete User",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "badad9a8-d367-4542-882e-a3b2a56334fe",
            "type": "text/javascript",
            "exec": [
              "var jsonData = JSON.parse(responseBody);",
              "tests[\"Delete Success\"] = jsonData.deleted == 1",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "body": {},
        "url": {
          "raw": "http://127.0.0.1:3000/dev_consus/patient/*?filter={\"_id\":{{patient_id}}}",
          "protocol": "http",
          "host": [
            "127",
            "0",
            "0",
            "1"
          ],
          "port": "3000",
          "path": [
            "dev_consus",
            "patient",
            "*"
          ],
          "query": [
            {
              "key": "filter",
              "value": "{\"_id\":{{patient_id}}}",
              "equals": true
            }
          ]
        },
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "8e81ff46-3ca7-4732-a248-6675abb11b1c",
      "name": "Delete User Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "0e04380f-f645-4618-b60c-d78fd6eccd03",
            "type": "text/javascript",
            "exec": [
              "var jsonData = JSON.parse(responseBody);",
              "tests[\"Delete Success\"] = jsonData.deleted == 1",
              "postman.clearGlobalVariable(\"minerva_user2\");",
              "postman.clearGlobalVariable(\"minerva_user\");",
              "postman.clearGlobalVariable(\"user_id\");",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "body": {},
        "url": {
          "raw": "http://127.0.0.1:3000/dev_consus/user/*?filter={\"_id\":{{user_id}}}",
          "protocol": "http",
          "host": [
            "127",
            "0",
            "0",
            "1"
          ],
          "port": "3000",
          "path": [
            "dev_consus",
            "user",
            "*"
          ],
          "query": [
            {
              "key": "filter",
              "value": "{\"_id\":{{user_id}}}",
              "equals": true
            }
          ]
        },
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "5571ddac-9326-4650-b69d-3e7520b9e235",
      "name": "Update User Next_id",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "6465e162-6b21-48f5-b6f0-4b5b7e0ec6af",
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n\t\"$inc\":{\"next_id\":-1}\n}"
        },
        "url": "http://127.0.0.1:3000/dev_consus/user.next_id/user",
        "description": null
      },
      "response": []
    },
    {
      "_postman_id": "62e58f37-584e-4e5b-89d6-9259b89d2668",
      "name": "Update Patient Next_id",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "6465e162-6b21-48f5-b6f0-4b5b7e0ec6af",
            "type": "text/javascript",
            "exec": [
              "tests[\"Status code is 200\"] = responseCode.code === 200;"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n\t\"$inc\":{\"next_id\":-1}\n}"
        },
        "url": "http://127.0.0.1:3000/dev_consus/user.next_id/user",
        "description": null
      },
      "response": []
    }
  ]
}